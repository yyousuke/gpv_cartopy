#
#  2021/06/01 Yamashita
#
import subprocess
from matplotlib.colors import LinearSegmentedColormap

from .cutil import ColUtils

__all__ = [
   "MapRegion"
]

#from mpl_toolkits.basemap import cm
#cmap = cm.s3pcpn_l  # 色テーブルの選択
# 色テーブルの設定 (basemap cmのs3pcpn_l_dataのコードを利用）
_s3pcpn_l_data = {
    'blue':
    [(0.0, 1.0, 1.0),
     (0.050000000000000003, 0.81568628549575806, 0.81568628549575806),
     (0.10000000000000001, 1.0, 1.0),
     (0.14999999999999999, 0.50196081399917603, 0.50196081399917603),
     (0.20000000000000001, 0.0, 0.0), (0.25, 0.0, 0.0),
     (0.29999999999999999, 0.0, 0.0), (0.34999999999999998, 0.0, 0.0),
     (0.40000000000000002, 0.0, 0.0),
     (0.45000000000000001, 0.50196081399917603, 0.50196081399917603),
     (0.5, 1.0, 1.0), (0.55000000000000004, 1.0, 1.0),
     (0.59999999999999998, 1.0, 1.0),
     (0.65000000000000002, 0.50196081399917603, 0.50196081399917603),
     (0.69999999999999996, 0.12549020349979401, 0.12549020349979401),
     (0.75, 0.50196081399917603, 0.50196081399917603),
     (0.80000000000000004, 0.87843137979507446, 0.87843137979507446),
     (0.84999999999999998, 0.73725491762161255, 0.73725491762161255),
     (0.90000000000000002, 0.47058823704719543, 0.47058823704719543),
     (0.94999999999999996, 0.23529411852359772, 0.23529411852359772),
     (1.0, 0.0, 0.0)],
    'green':
    [(0.0, 1.0, 1.0),
     (0.050000000000000003, 0.81568628549575806, 0.81568628549575806),
     (0.10000000000000001, 1.0, 1.0),
     (0.14999999999999999, 0.87843137979507446, 0.87843137979507446),
     (0.20000000000000001, 0.75294119119644165, 0.75294119119644165),
     (0.25, 0.87843137979507446, 0.87843137979507446),
     (0.29999999999999999, 1.0, 1.0),
     (0.34999999999999998, 0.62745100259780884, 0.62745100259780884),
     (0.40000000000000002, 0.0, 0.0),
     (0.45000000000000001, 0.12549020349979401, 0.12549020349979401),
     (0.5, 0.25098040699958801, 0.25098040699958801),
     (0.55000000000000004, 0.12549020349979401, 0.12549020349979401),
     (0.59999999999999998, 0.25098040699958801, 0.25098040699958801),
     (0.65000000000000002, 0.12549020349979401, 0.12549020349979401),
     (0.69999999999999996, 0.12549020349979401, 0.12549020349979401),
     (0.75, 0.50196081399917603, 0.50196081399917603),
     (0.80000000000000004, 0.87843137979507446, 0.87843137979507446),
     (0.84999999999999998, 0.83137255907058716, 0.83137255907058716),
     (0.90000000000000002, 0.65098041296005249, 0.65098041296005249),
     (0.94999999999999996, 0.42352941632270813, 0.42352941632270813),
     (1.0, 0.20000000298023224, 0.20000000298023224)],
    'red':
    [(0.0, 1.0, 1.0),
     (0.050000000000000003, 0.31372550129890442, 0.31372550129890442),
     (0.10000000000000001, 0.0, 0.0), (0.14999999999999999, 0.0, 0.0),
     (0.20000000000000001, 0.0, 0.0),
     (0.25, 0.50196081399917603, 0.50196081399917603),
     (0.29999999999999999, 1.0, 1.0), (0.34999999999999998, 1.0, 1.0),
     (0.40000000000000002, 1.0, 1.0), (0.45000000000000001, 1.0, 1.0),
     (0.5, 0.94117647409439087, 0.94117647409439087),
     (0.55000000000000004, 0.50196081399917603, 0.50196081399917603),
     (0.59999999999999998, 0.25098040699958801, 0.25098040699958801),
     (0.65000000000000002, 0.12549020349979401, 0.12549020349979401),
     (0.69999999999999996, 0.12549020349979401, 0.12549020349979401),
     (0.75, 0.50196081399917603, 0.50196081399917603),
     (0.80000000000000004, 0.87843137979507446, 0.87843137979507446),
     (0.84999999999999998, 0.93333333730697632, 0.93333333730697632),
     (0.90000000000000002, 0.85490196943283081, 0.85490196943283081),
     (0.94999999999999996, 0.62745100259780884, 0.62745100259780884),
     (1.0, 0.40000000596046448, 0.40000000596046448)]
}

#from mpl_toolkits.basemap import cm
#cmap = cm.GMT_wysiwyg # 色テーブルの選択
# 色テーブルの設定 (basemap cmの_GMT_wysiwyg_dataのコードを利用）
_wysiwyg_data = {
    'blue': [(0.0, 0.250980407, 0.250980407),
             (0.0526315793395, 0.752941191196, 0.752941191196),
             (0.105263158679, 1.0, 1.0), (0.157894730568, 1.0, 1.0),
             (0.210526317358, 1.0, 1.0), (0.263157904148, 1.0, 1.0),
             (0.315789461136, 1.0, 1.0), (0.368421047926, 1.0, 1.0),
             (0.421052634716, 0.752941191196, 0.752941191196),
             (0.473684221506, 0.250980407, 0.250980407),
             (0.526315808296, 0.250980407, 0.250980407),
             (0.578947365284, 0.250980407, 0.250980407),
             (0.631578922272, 0.250980407, 0.250980407),
             (0.684210538864, 0.250980407, 0.250980407),
             (0.736842095852, 0.250980407, 0.250980407),
             (0.789473712444, 0.250980407, 0.250980407),
             (0.842105269432, 0.250980407, 0.250980407),
             (0.89473682642, 0.752941191196, 0.752941191196),
             (0.947368443012, 1.0, 1.0), (1.0, 1.0, 1.0)],
    'green': [(0.0, 0.0, 0.0), (0.0526315793395, 0.0, 0.0),
              (0.105263158679, 0.250980407, 0.250980407),
              (0.157894730568, 0.501960813999, 0.501960813999),
              (0.210526317358, 0.627451002598, 0.627451002598),
              (0.263157904148, 0.752941191196, 0.752941191196),
              (0.315789461136, 0.878431379795, 0.878431379795),
              (0.368421047926, 1.0, 1.0), (0.421052634716, 1.0, 1.0),
              (0.473684221506, 1.0, 1.0), (0.526315808296, 1.0, 1.0),
              (0.578947365284, 1.0, 1.0), (0.631578922272, 1.0, 1.0),
              (0.684210538864, 0.878431379795, 0.878431379795),
              (0.736842095852, 0.627451002598, 0.627451002598),
              (0.789473712444, 0.376470595598, 0.376470595598),
              (0.842105269432, 0.1254902035, 0.1254902035),
              (0.89473682642, 0.376470595598, 0.376470595598),
              (0.947368443012, 0.627451002598, 0.627451002598),
              (1.0, 0.878431379795, 0.878431379795)],
    'red': [(0.0, 0.250980407, 0.250980407),
            (0.0526315793395, 0.250980407, 0.250980407),
            (0.105263158679, 0.0, 0.0), (0.157894730568, 0.0, 0.0),
            (0.210526317358, 0.0, 0.0),
            (0.263157904148, 0.250980407, 0.250980407),
            (0.315789461136, 0.250980407, 0.250980407),
            (0.368421047926, 0.250980407, 0.250980407),
            (0.421052634716, 0.250980407, 0.250980407),
            (0.473684221506, 0.250980407, 0.250980407),
            (0.526315808296, 0.501960813999, 0.501960813999),
            (0.578947365284, 0.752941191196, 0.752941191196),
            (0.631578922272, 1.0, 1.0), (0.684210538864, 1.0, 1.0),
            (0.736842095852, 1.0, 1.0), (0.789473712444, 1.0, 1.0),
            (0.842105269432, 1.0, 1.0), (0.89473682642, 1.0, 1.0),
            (0.947368443012, 1.0, 1.0), (1.0, 1.0, 1.0)]
}


# ColUtils: カラーユーティリティ
class ColUtils():
    def __init__(self, cmap_name=None):
        self.cmap_name = cmap_name

    def get_ctable(self):
        if self.cmap_name == "s3pcpn_l":
            _segment_data = _s3pcpn_l_data
        elif self.cmap_name == "wysiwyg":
            _segment_data = _wysiwyg_data
        else:
            raise Exception("invalid cmap_name")

        _cmap = LinearSegmentedColormap('colormap_name', _segment_data)
        return _cmap
    

# convertを使い、pngからgifアニメーションに変換する
def convert_png2gif(input_filenames, delay="80", output_filename="output.gif"):
    args = ["convert", "-delay", delay]
    args.extend(input_filenames)
    args.append(output_filename)
    print(args)
    # コマンドとオプション入出力ファイルのリストを渡し、変換の実行
    res = subprocess.run(args=args,
                         stdout=subprocess.PIPE,
                         stderr=subprocess.PIPE)
    print(res.stdout.decode("utf-8"))
    print(res.stderr.decode("utf-8"))

